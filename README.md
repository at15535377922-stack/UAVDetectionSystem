# UAV Detection System — 无人机巡检系统

## 1. 项目概述

本项目旨在构建一套**基于无人机的智能巡检系统**，集成无人机飞行控制、实时视频流传输、AI 目标检测与异常识别、巡检任务管理及数据可视化等功能，适用于电力线路巡检、光伏电站巡检、建筑工地监控、农业植保监测等场景。

### 1.1 核心目标

- **自动化巡检**：支持预设航线自主飞行，减少人工干预
- **实时检测**：机载/地面端 AI 模型对视频流进行实时目标检测与缺陷识别
- **数据闭环**：巡检数据自动归档、生成报告，支持历史对比与趋势分析
- **多机协同**（远期）：支持多架无人机协同作业，提升巡检效率

---

## 2. 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                      前端 (Web/Desktop)                  │
│   React + TypeScript + TailwindCSS + Leaflet/Cesium     │
│   ┌──────────┐ ┌──────────┐ ┌───────────┐ ┌──────────┐ │
│   │ 实时监控  │ │ 任务管理  │ │ 数据报告   │ │ 系统设置  │ │
│   └──────────┘ └──────────┘ └───────────┘ └──────────┘ │
└────────────────────────┬────────────────────────────────┘
                         │ REST / WebSocket
┌────────────────────────┴────────────────────────────────┐
│                    后端服务 (Backend)                     │
│              Python (FastAPI) / Node.js                   │
│   ┌──────────┐ ┌──────────┐ ┌───────────┐ ┌──────────┐ │
│   │ 用户认证  │ │ 任务调度  │ │ 数据存储   │ │ 消息推送  │ │
│   └──────────┘ └──────────┘ └───────────┘ └──────────┘ │
└──────┬─────────────┬────────────────┬───────────────────┘
       │             │                │
┌──────┴──────┐ ┌────┴─────┐ ┌───────┴────────┐
│  AI 检测服务 │ │ 飞控通信  │ │  数据库/存储    │
│  YOLOv8/v11 │ │ MAVLink  │ │ PostgreSQL     │
│  PyTorch    │ │ MAVSDK   │ │ MinIO (OSS)    │
│  TensorRT   │ │ ROS2     │ │ Redis          │
└─────────────┘ └──────────┘ └────────────────┘
```

---

## 3. 技术栈

| 层级 | 技术选型 | 说明 |
|------|---------|------|
| **前端** | React 18 + TypeScript | SPA 单页应用 |
| **UI 框架** | TailwindCSS + shadcn/ui | 现代化 UI 组件 |
| **地图引擎** | Leaflet / Cesium | 2D/3D 地图与航线规划 |
| **视频流** | WebRTC / HLS | 实时视频传输与回放 |
| **后端** | FastAPI (Python 3.11+) | 高性能异步 API 服务 |
| **AI 推理** | YOLOv8/v11 + PyTorch | 目标检测与缺陷识别 |
| **推理加速** | TensorRT / ONNX Runtime | GPU 推理加速 |
| **飞控通信** | MAVLink + MAVSDK-Python | 无人机指令收发 |
| **数据库** | PostgreSQL 15 | 结构化数据存储 |
| **缓存** | Redis 7 | 会话管理与实时状态缓存 |
| **对象存储** | MinIO | 图片/视频/模型文件存储 |
| **消息队列** | RabbitMQ / Redis Streams | 异步任务与事件驱动 |
| **容器化** | Docker + Docker Compose | 开发与部署环境一致性 |

---

## 4. 功能模块

### 4.1 飞行控制模块

| 功能 | 描述 |
|------|------|
| 航线规划 | 在地图上绘制巡检航线，设置航点、高度、速度、悬停时间 |
| 自主飞行 | 按预设航线自动起飞、巡航、返航 |
| 实时遥测 | 显示无人机位置、姿态、电量、信号强度等实时数据 |
| 应急控制 | 一键返航、紧急悬停、手动接管 |

### 4.2 视频流与图像采集模块

| 功能 | 描述 |
|------|------|
| 实时视频 | 通过 WebRTC 传输机载摄像头实时画面 |
| 定点拍照 | 在指定航点自动触发高分辨率拍照 |
| 视频录制 | 全程录制巡检视频，支持回放 |
| 画面标注 | 在视频流上实时叠加 AI 检测结果 |

### 4.3 AI 检测模块

| 功能 | 描述 |
|------|------|
| 目标检测 | 基于 YOLOv8/v11 检测巡检目标（如绝缘子、光伏板、裂缝等） |
| 缺陷识别 | 识别设备异常（破损、锈蚀、异物悬挂、热斑等） |
| 模型管理 | 支持模型版本管理、在线更新、A/B 测试 |
| 边缘推理 | 支持在机载边缘设备（Jetson）上运行轻量模型 |

### 4.4 任务管理模块

| 功能 | 描述 |
|------|------|
| 任务创建 | 创建巡检任务，关联航线、检测模型、执行时间 |
| 任务调度 | 定时/周期性自动执行巡检任务 |
| 任务监控 | 实时查看任务执行进度与状态 |
| 任务历史 | 查询历史任务记录与执行结果 |

### 4.5 数据管理与报告模块

| 功能 | 描述 |
|------|------|
| 数据归档 | 巡检图片、视频、检测结果自动归档 |
| 缺陷台账 | 按设备/区域/类型统计缺陷，生成台账 |
| 巡检报告 | 自动生成 PDF/Excel 巡检报告 |
| 趋势分析 | 历史数据对比，展示缺陷变化趋势 |

### 4.6 系统管理模块

| 功能 | 描述 |
|------|------|
| 用户管理 | 角色权限控制（管理员/操作员/查看者） |
| 设备管理 | 无人机、摄像头、边缘设备的注册与状态管理 |
| 系统日志 | 操作日志、飞行日志、异常告警记录 |
| 系统配置 | 检测阈值、告警规则、通知渠道等参数配置 |

---

## 5. 项目目录结构

```
UAVDetectionSystem/
├── frontend/                  # 前端项目
│   ├── src/
│   │   ├── components/        # 通用 UI 组件
│   │   ├── pages/             # 页面视图
│   │   │   ├── Dashboard/     # 总览仪表盘
│   │   │   ├── Monitor/       # 实时监控
│   │   │   ├── Mission/       # 任务管理
│   │   │   ├── Report/        # 数据报告
│   │   │   └── Settings/      # 系统设置
│   │   ├── services/          # API 调用封装
│   │   ├── stores/            # 状态管理
│   │   └── utils/             # 工具函数
│   ├── package.json
│   └── vite.config.ts
│
├── backend/                   # 后端服务
│   ├── app/
│   │   ├── api/               # API 路由
│   │   │   ├── auth.py        # 认证接口
│   │   │   ├── missions.py    # 任务接口
│   │   │   ├── devices.py     # 设备接口
│   │   │   ├── detections.py  # 检测结果接口
│   │   │   └── reports.py     # 报告接口
│   │   ├── core/              # 核心配置
│   │   │   ├── config.py      # 应用配置
│   │   │   ├── security.py    # 安全与鉴权
│   │   │   └── database.py    # 数据库连接
│   │   ├── models/            # 数据模型 (SQLAlchemy)
│   │   ├── schemas/           # Pydantic 数据校验
│   │   ├── services/          # 业务逻辑
│   │   └── main.py            # FastAPI 入口
│   ├── requirements.txt
│   └── Dockerfile
│
├── ai_service/                # AI 检测服务
│   ├── models/                # 模型权重文件
│   ├── inference/             # 推理引擎
│   │   ├── detector.py        # 检测器封装
│   │   ├── preprocessor.py    # 图像预处理
│   │   └── postprocessor.py   # 后处理与 NMS
│   ├── training/              # 模型训练脚本
│   │   ├── train.py
│   │   ├── dataset.py
│   │   └── augmentation.py
│   ├── requirements.txt
│   └── Dockerfile
│
├── flight_control/            # 飞控通信模块
│   ├── mavlink_client.py      # MAVLink 通信客户端
│   ├── mission_executor.py    # 航线任务执行器
│   ├── telemetry.py           # 遥测数据采集
│   └── safety.py              # 安全策略（地理围栏、电量保护）
│
├── docker-compose.yml         # 容器编排
├── .env.example               # 环境变量模板
├── docs/                      # 项目文档
│   ├── api.md                 # API 文档
│   ├── deployment.md          # 部署指南
│   └── architecture.md        # 架构设计文档
└── README.md                  # 本文件
```

---

## 6. 实施计划

### 第一阶段：基础框架搭建（第 1-3 周）

- [x] 项目初始化与目录结构搭建
- [ ] 前端脚手架搭建（React + Vite + TailwindCSS）
- [ ] 后端 FastAPI 项目初始化，数据库模型设计
- [ ] 用户认证模块（JWT 登录/注册/权限）
- [ ] Docker Compose 开发环境配置
- [ ] CI/CD 流水线搭建

### 第二阶段：核心功能开发（第 4-8 周）

- [ ] 地图组件集成（Leaflet），航线绘制与编辑
- [ ] 飞控通信模块（MAVLink 连接、遥测数据接收）
- [ ] 任务管理 CRUD（创建/编辑/删除/查询）
- [ ] 视频流接入（WebRTC 推拉流）
- [ ] AI 检测服务搭建（YOLOv8 推理 Pipeline）
- [ ] 实时监控页面（地图 + 视频 + 遥测数据联动）

### 第三阶段：AI 模型训练与优化（第 9-12 周）

- [ ] 巡检场景数据集采集与标注
- [ ] YOLOv8/v11 模型训练与评估
- [ ] TensorRT 模型导出与推理加速
- [ ] 边缘端（Jetson）模型部署与测试
- [ ] 检测结果与视频流叠加展示

### 第四阶段：数据分析与报告（第 13-15 周）

- [ ] 缺陷数据统计与可视化（ECharts）
- [ ] 巡检报告自动生成（PDF/Excel）
- [ ] 历史数据对比与趋势分析
- [ ] 告警规则配置与通知推送（邮件/钉钉/企微）

### 第五阶段：测试与部署（第 16-18 周）

- [ ] 单元测试与集成测试
- [ ] 外场飞行联调测试
- [ ] 性能优化与压力测试
- [ ] 生产环境部署（K8s / 云服务器）
- [ ] 用户文档与培训

---

## 7. 环境要求

### 开发环境

| 依赖 | 版本要求 |
|------|---------|
| Python | >= 3.11 |
| Node.js | >= 18 LTS |
| PostgreSQL | >= 15 |
| Redis | >= 7 |
| Docker | >= 24 |
| CUDA（GPU 推理） | >= 11.8 |

### 硬件建议

| 组件 | 推荐配置 |
|------|---------|
| 开发机 GPU | NVIDIA RTX 3060 及以上 |
| 边缘设备 | NVIDIA Jetson Orin Nano / Xavier NX |
| 无人机 | DJI Matrice 系列 / PX4 开源飞控 |
| 摄像头 | 4K 可见光 + 红外热成像（可选） |

---

## 8. 快速开始

```bash
# 1. 克隆项目
git clone https://github.com/at15535377922-stack/UAVDetectionSystem.git
cd UAVDetectionSystem

# 2. 复制环境变量
cp .env.example .env

# 3. 使用 Docker Compose 启动所有服务
docker-compose up -d

# 4. 访问前端
# http://localhost:3000

# 5. 访问后端 API 文档
# http://localhost:8000/docs
```

---

## 9. 许可证

本项目采用 [MIT License](LICENSE) 开源协议。

---

## 10. 联系方式

如有问题或建议，请通过 [Issues](https://github.com/at15535377922-stack/UAVDetectionSystem/issues) 提交。
